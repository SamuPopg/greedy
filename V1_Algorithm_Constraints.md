# V1 算法硬性约束完整清单

本文件详细列出了V1版本装载优化算法（位于 `src/` 目录）当前所严格遵守的全部硬性约束。这些规则共同定义了算法在寻找最优解时的可行边界。

---

### 1. 宏观操作与空间分区约束 (Macro-Level Constraints)

这类约束定义了整个装载流程的最高优先级规则，确保其符合物流操作顺序和区域划分。

| 约束名称 | 详细描述 | 代码实现与来源 |
| :--- | :--- | :--- |
| **严格的供应商装载顺序** | 这是算法的**最高层级约束**。算法必须严格按照一个预设的供应商顺序进行装载。例如，如果顺序是`A->B->C`，那么A的货物必须最先装、放在最里面；C的货物必须最后装、放在最外面。 | **来源**: `集装箱需求.txt` (核心业务流程)。<br>**实现**: 由上层的 `PermutationOptimizer` 控制。它会生成供应商顺序的全排列，然后将**每一种固定的顺序**分别传递给 `GreedyContainerOptimizer` 进行一次完整的、独立的计算。 |
| **供应商区域物理隔离** | 在一次计算中，不同供应商的货物**不能混合摆放**。算法会根据每个供应商的货物体积比例，沿集装箱长度方向（X轴）为每个供应商划分一个逻辑上的专属“领地”。货物的放置不能超出其供应商所属领地的X轴边界。 | **来源**: 遵循供应商顺序的必然要求。<br>**实现**: 在 `GreedyContainerOptimizer` 的 `_create_supplier_regions` 方法中计算每个Region的 `start_position` 和 `end_position`。在 `_is_valid_placement` 方法中，通过 `if not (px >= region.start_position and px + pl <= region.end_position)` 来强制执行。 |

---

### 2. 核心物理约束 (Core Physical Constraints)

这类约束模拟了最基本的物理法则，是任何装箱算法都必须满足的基础。

| 约束名称 | 详细描述 | 代码实现与来源 |
| :--- | :--- | :--- |
| **不可超出集装箱边界** | 任何已放置货物的任何部分都不能超出集装箱的宽度（Y轴）和高度（Z轴）边界。 | **来源**: 物理现实。<br>**实现**: 在 `_is_valid_placement` 方法中，通过 `if not (py >= 0 and pz >= 0 and py + pw <= self.container_dims[1] and pz + ph <= self.container_dims[2])` 来检查。 |
| **禁止物体空间重叠** | 两个或多个货物不能占据同一个物理空间。 | **来源**: 物理现实。<br>**实现**: 在我们最近的修改中，此项检查已升级。在 `_is_valid_placement` 方法中，通过 `if np.any(self.space[...])` 进行高效的体素化碰撞检查，确保待放置区域在 `self.space` 数组中没有任何已被占据的单元格。 |

---

### 3. 货物稳定与安全约束 (Stability & Safety Constraints)

这类约束确保货物在放置和运输过程中的物理稳定性，防止倾倒、悬空和损坏。

| 约束名称 | 详细描述 | 代码实现与来源 |
| :--- | :--- | :--- |
| **底部支撑面积约束 (防悬空)** | 一个货物被放置在其他货物之上时，其底部的**支撑面积必须至少达到其自身底面积的70%**。这防止了危险的大面积悬空。 | **来源**: `集装箱装载优化讨论记录.md` 中记录的稳定性要求。<br>**实现**: 在 `_is_valid_placement` 中调用 `_calculate_support_ratio` 方法计算支撑率，并与 `0.7` 进行比较。 |
| **重心稳定约束 (防倾倒)** | 一个货物被放置在其他货物之上时，其**重心（底面中心点）必须落在其下方支撑物的有效范围之内**（考虑了15%的内缩安全边距）。这确保了货物不会因为重心偏移而倾倒。 | **来源**: `集装箱装载优化讨论记录.md` 中记录的稳定性要求。<br>**实现**: 在 `_is_valid_placement` 中调用 `_check_center_stability` 方法来执行此项检查。 |
| **易碎品分层摆放约束** | 根据所有货物的高度分布，算法会预先计算出一套整体的分层方案。此方案**禁止将不适合立放的货物（通常指易碎品）放置在较低的楼层**。例如，它可能会规定在高度 `z < 100cm` 的区域内，不允许使用“立放”姿态。 | **来源**: `集装箱需求.txt` ("下两层禁止立放")。<br>**实现**: 在 `GreedyContainerOptimizer` 中初始化 `LayerStrategy` 对象。在 `_is_valid_placement` 中通过 `if orientation not in self.layer_strategy.get_allowed_placements(pz)` 来检查当前摆法是否被当前高度层所允许。 |
| **防止多米诺骨牌效应** | **(最新加入)** 为防止货物在开门时向外倾倒，禁止将摆放方式为 `侧放1 (SIDE_LYING_X)` 和 `躺放2 (LYING_Y)` 的货物沿集装箱长度方向（X轴）紧邻放置。 | **来源**: `集装箱需求.txt` (第31行)。<br>**实现**: 在 `_is_valid_placement` 中调用我们新增加的 `_check_domino_effect` 方法来执行此项检查。 | 